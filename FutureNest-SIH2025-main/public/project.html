<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Career Preferences - Short Quiz</title>
  <style>
    :root {
      --bg: #0b0c10;
      --card: #ffffff;
      --text: #0f172a;
      --muted: #6b7280;
      --brand: #0ea5e9;
      --brand-strong: #0284c7;
      --accent: #f59e0b;
      --pill: #f1f5f9;
      --pill-active: #e0f2fe;
      --border: #e5e7eb;
      --shadow: 0 10px 25px rgba(2, 8, 23, 0.08);
      --radius: 14px;
    }

    html,
    body {
      height: 100%
    }

    body {
      margin: 0;
      display: grid;
      place-items: center;
      background: linear-gradient(180deg, #eef2ff, #f8fafc);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
    }

    .card {
      width: min(900px, 92vw);
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .header {
      padding: 22px 24px 12px
    }

    .title {
      font-size: 20px;
      font-weight: 700
    }

    .subtitle {
      font-size: 14px;
      color: var(--muted);
      margin-top: 2px
    }

    .progress-wrap {
      margin-top: 16px
    }

    .progress {
      height: 10px;
      background: #eef2f7;
      border-radius: 999px;
      overflow: hidden;
      position: relative;
    }

    .bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--brand), var(--brand-strong));
      transition: width .3s ease;
      border-radius: inherit;
    }

    .content {
      padding: 10px 24px 20px
    }

    .qnum {
      font-size: 14px;
      color: var(--muted);
      margin-bottom: 6px
    }

    .question {
      font-size: 22px;
      font-weight: 700;
      letter-spacing: -0.01em
    }

    .options {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 16px 0 6px
    }

    .pill {
      border: 1px solid var(--border);
      background: var(--pill);
      color: #0b1220;
      padding: 10px 14px;
      border-radius: 999px;
      cursor: pointer;
      transition: all .15s ease;
      font-weight: 600;
    }

    .pill:hover {
      transform: translateY(-1px);
      background: #eef2ff
    }

    .pill[aria-pressed="true"] {
      background: var(--pill-active);
      border-color: #bae6fd;
      color: #075985
    }

    .followup {
      margin-top: 8px
    }

    .followup label {
      display: block;
      font-size: 14px;
      color: var(--muted);
      margin-bottom: 6px
    }

    .followup textarea {
      width: 100%;
      min-height: 74px;
      resize: vertical;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px 12px;
      font: inherit;
      outline: none;
      transition: border-color .15s ease, box-shadow .15s ease;
    }

    .followup textarea:focus {
      border-color: #93c5fd;
      box-shadow: 0 0 0 3px #dbeafe
    }

    .footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      padding: 16px 24px;
      background: #fbfdff;
      border-top: 1px solid var(--border);
    }

    .btn {
      border: 1px solid var(--border);
      background: #fff;
      color: #0b1220;
      padding: 10px 16px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 700;
    }

    .btn.secondary {
      color: #475569
    }

    .btn.primary {
      background: var(--accent);
      border-color: #f59e0b;
      color: #111827
    }

    .btn:disabled {
      opacity: .55;
      cursor: not-allowed
    }

    .right {
      display: flex;
      gap: 10px
    }

    .notice {
      font-size: 12px;
      color: var(--muted)
    }
    
    /* Completion Page Styles */
    .completion-page {
      display: none;
      text-align: center;
      padding: 40px 24px;
    }
    
    .completion-page.show {
      display: block;
    }
    
    .completion-icon {
      margin-bottom: 20px;
      display: inline-block;
      color: var(--brand);
    }
    
    .completion-icon svg {
      width: 64px;
      height: 64px;
    }
    
    .completion-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 12px;
    }
    
    .completion-subtitle {
      font-size: 16px;
      color: var(--muted);
      margin-bottom: 30px;
      line-height: 1.5;
    }
    
    .quiz-content {
      display: block;
    }
    
    .quiz-content.hide {
      display: none;
    }
    
    /* Loading state for buttons */
    .btn.loading {
      background: #6b7280;
      color: white;
      cursor: not-allowed;
      position: relative;
    }
    
    .btn.loading .loading-spinner {
      display: inline-block;
      width: 14px;
      height: 14px;
      border: 2px solid transparent;
      border-top: 2px solid currentColor;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 8px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @media (max-width:520px) {
      .question {
        font-size: 19px
      }

      .pill {
        padding: 9px 12px
      }
      
      .completion-title {
        font-size: 24px
      }
      
      .completion-icon svg {
        width: 48px;
        height: 48px;
      }
    }
  </style>
</head>

<body>
  <section class="card" role="form" aria-labelledby="quiz-title">
    <div class="header">
      <div id="quiz-title" class="title"> tailored career recommendations</div>
      <div class="subtitle">Answer a few quick questions</div>
      <div class="progress-wrap" aria-hidden="true">
        <div class="progress">
          <div class="bar" id="progress-bar"></div>
        </div>
      </div>
    </div>

    <div class="content">
      <div class="quiz-content" id="quiz-content">
        <div class="qnum" id="q-count">Question 1 of 10</div>
        <div class="question" id="q-text">Loading…</div>

        <div class="options" id="options"></div>

        <div class="followup" id="followup" hidden>
          <label id="followup-label" for="followup-input"></label>
          <textarea id="followup-input" placeholder="Type your answer…"></textarea>
        </div>
      </div>
      
      <div class="completion-page" id="completion-page">
        <div class="completion-icon">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
            <polyline points="22,4 12,14.01 9,11.01"/>
          </svg>
        </div>
        <div class="completion-title">Quiz Completed!</div>
        <div class="completion-subtitle">
          Thank you for completing the career assessment. Your responses will help us provide personalized career recommendations tailored to your interests and strengths.
        </div>
        <button class="btn primary" id="save-results-btn" type="button">
          Save Results & Continue
        </button>
      </div>
    </div>

    <div class="footer">
      <button class="btn secondary" id="back-btn" type="button">Back</button>
      <div class="right">
        <button class="btn secondary" id="skip-btn" type="button">Skip</button>
        <button class="btn primary" id="next-btn" type="button">Next</button>
        <button class="btn primary" id="done-btn" type="button" hidden>Done</button>
      </div>
    </div>
  </section>

  <script>
    // Quiz model
    const QUESTIONS = [
      {
        id: "interest",
        prompt: "Which of the following activities do you most enjoy doing in your free time?",
        followup: "Why do you enjoy this activity?",
        options: [
          ["A", "Solving puzzles or problems"],
          ["B", "Helping others or volunteering"],
          ["C", "Drawing, painting, or creating"],
          ["D", "Organizing events or planning activities"],
          ["E", "Writing stories, blogs, or essays"]
        ]
      },
      {
        id: "skills",
        prompt: "Which of these skills do you feel most confident in?",
        followup: "How do you think these skills can help you in a career?",
        options: [
          ["A", "Communication and public speaking"],
          ["B", "Analytical thinking and problem solving"],
          ["C", "Creative thinking and design"],
          ["D", "Working with technology or computers"],
          ["E", "Teamwork and leadership"]
        ]
      },
      {
        id: "env",
        prompt: "Which type of work environment do you think you would enjoy the most?",
        options: [
          ["A", "A busy office with lots of interaction"],
          ["B", "A quiet, independent setting"],
          ["C", "A dynamic and fast-paced environment"],
          ["D", "A flexible, remote work setup"],
          ["E", "A field or hands-on role"]
        ]
      },
      {
        id: "values",
        prompt: "What is most important to you in a career?",
        options: [
          ["A", "Making a difference in society"],
          ["B", "Financial stability and growth"],
          ["C", "Having creative freedom"],
          ["D", "Flexibility and work-life balance"],
          ["E", "Career advancement and leadership opportunities"]
        ]
      },
      {
        id: "strengths",
        prompt: "Which of the following best describes your academic strengths?",
        followup: "Which subject or activity do you enjoy most, and why?",
        options: [
          ["A", "Strong in math and logical reasoning"],
          ["B", "Excellent at writing and communication"],
          ["C", "Creative and artistic"],
          ["D", "Technologically skilled"],
          ["E", "Good at understanding and working with people"]
        ]
      },
      {
        id: "future",
        prompt: "Where do you see yourself in 5 years?",
        options: [
          ["A", "Managing a team or leading a project"],
          ["B", "Starting my own business or freelance career"],
          ["C", "Working in a creative role or industry"],
          ["D", "Contributing to a cause or nonprofit organization"],
          ["E", "In a research or technical role"]
        ]
      },
      {
        id: "problemStyle",
        prompt: "How do you prefer to approach a problem at work or in your personal life?",
        options: [
          ["A", "Break it down into smaller steps and tackle one at a time"],
          ["B", "Brainstorm ideas with others to find the best solution"],
          ["C", "Dive straight into action and figure things out as you go"],
          ["D", "Do thorough research before coming up with a solution"],
          ["E", "Ask for guidance from someone with more experience"]
        ]
      },
      {
        id: "learning",
        prompt: "How do you learn best?",
        options: [
          ["A", "Through reading and studying independently"],
          ["B", "By watching videos or tutorials"],
          ["C", "By practicing or doing hands-on tasks"],
          ["D", "Through discussions and group work"],
          ["E", "By asking questions and seeking mentorship"]
        ]
      },
      {
        id: "challenges",
        prompt: "What do you think is your biggest challenge when it comes to choosing a career?",
        options: [
          ["A", "Not knowing what I’m truly passionate about"],
          ["B", "Feeling uncertain about my skills and abilities"],
          ["C", "Worrying about job stability or opportunities"],
          ["D", "Not sure if I want to stick to a specific career path"],
          ["E", "Finding a job that aligns with my values"]
        ]
      },
      {
        id: "dreamJob",
        prompt: "If you could have any job in the world for one week, what would it be?",
        options: [
          ["A", "A tech entrepreneur creating new apps or software"],
          ["B", "A doctor or healthcare professional saving lives"],
          ["C", "An artist or designer working on innovative projects"],
          ["D", "A scientist conducting groundbreaking research"],
          ["E", "A social worker helping people in need"]
        ]
      }
    ];

    // State
    let index = 0;
    const answers = {}; // { [id]: { choice: "A".."E" | null, followup?: string } }

  // Elements
  const qCount = document.getElementById("q-count");
  const qText = document.getElementById("q-text");
  const optionsWrap = document.getElementById("options");
  const followup = document.getElementById("followup");
  const followupLabel = document.getElementById("followup-label");
  const followupInput = document.getElementById("followup-input");
  const progressBar = document.getElementById("progress-bar");
  const quizContent = document.getElementById("quiz-content");
  const completionPage = document.getElementById("completion-page");

  const nextBtn = document.getElementById("next-btn");
  const doneBtn = document.getElementById("done-btn");
  const backBtn = document.getElementById("back-btn");
  const skipBtn = document.getElementById("skip-btn");
  const saveResultsBtn = document.getElementById("save-results-btn");

  backBtn.addEventListener("click", () => go(-1));
  nextBtn.addEventListener("click", () => go(1));
  skipBtn.addEventListener("click", () => { setChoice(null); go(1); });
  doneBtn.addEventListener("click", showCompletionPage);
  saveResultsBtn.addEventListener("click", saveAndSubmit);

    // Keyboard: arrows to move focus among pills, Enter to confirm Next
    document.addEventListener("keydown", (e) => {
      const pills = [...optionsWrap.querySelectorAll(".pill")];
      const activeIndex = pills.findIndex(p => p === document.activeElement);
      if (e.key === "ArrowRight" || e.key === "ArrowDown") {
        e.preventDefault();
        (pills[(activeIndex + 1 + pills.length) % pills.length] || pills[0])?.focus();
      }
      if (e.key === "ArrowLeft" || e.key === "ArrowUp") {
        e.preventDefault();
        (pills[(activeIndex - 1 + pills.length) % pills.length] || pills[0])?.focus();
      }
      if (e.key === "Enter" && nextBtn.disabled === false && !doneBtn.hidden) {
        // let regular flow handle; no-op
      }
    });

    function render() {
      const q = QUESTIONS[index];
      const total = QUESTIONS.length;
      qCount.textContent = `Question ${index + 1} of ${total}`;
      qText.textContent = q.prompt;

      // Progress
      const answeredCount = Object.keys(answers).length;
      const pct = Math.round(((index) / total) * 100);
      progressBar.style.width = `${Math.max(pct, (answeredCount / total) * 100)}%`;

      // Options
      optionsWrap.innerHTML = "";
      const current = answers[q.id]?.choice ?? null;
      q.options.forEach(([key, label]) => {
        const btn = document.createElement("button");
        btn.className = "pill";
        btn.type = "button";
        btn.role = "button";
        btn.setAttribute("aria-pressed", current === key ? "true" : "false");
        btn.textContent = `${key}) ${label}`;
        btn.addEventListener("click", () => {
          setChoice(key);
        });
        optionsWrap.appendChild(btn);
      });

      // Follow-up
      const needsFU = Boolean(q.followup);
      followup.hidden = !needsFU;
      followupLabel.textContent = needsFU ? q.followup : "";
      followupInput.value = answers[q.id]?.followup ?? "";

      // Nav buttons
      backBtn.disabled = index === 0;
      nextBtn.hidden = index === total - 1;
      doneBtn.hidden = index !== total - 1;

      // Enable "Next" only if current question is answered
      const isCurrentAnswered = answers[q.id]?.choice !== null && answers[q.id]?.choice !== undefined;
      nextBtn.disabled = !isCurrentAnswered;
      doneBtn.disabled = !isCurrentAnswered;

      // Reflect selected pill state
      reflectSelected();
    }

    function reflectSelected() {
      const q = QUESTIONS[index];
      const current = answers[q.id]?.choice ?? null;
      optionsWrap.querySelectorAll(".pill").forEach(btn => {
        const isActive = btn.textContent.startsWith((current ?? "_") + ")");
        btn.setAttribute("aria-pressed", isActive ? "true" : "false");
      });
    }

    function setChoice(choice) {
      const q = QUESTIONS[index];
      answers[q.id] = {
        ...(answers[q.id] || {}),
        choice
      };
      reflectSelected();
      // Re-render to update button states
      render();
    }

    function go(delta) {
      // Check if trying to go forward without answering current question
      if (delta > 0) {
        const q = QUESTIONS[index];
        const isCurrentAnswered = answers[q.id]?.choice !== null && answers[q.id]?.choice !== undefined;
        if (!isCurrentAnswered) {
          return; // Don't allow forward navigation without answering
        }
      }

      // persist follow-up before leaving
      persistFollowup();
      index = Math.min(Math.max(0, index + delta), QUESTIONS.length - 1);
      render();
    }

    function persistFollowup() {
      const q = QUESTIONS[index];
      if (!q.followup) return;
      const text = followupInput.value.trim();
      if (!answers[q.id]) answers[q.id] = { choice: null };
      answers[q.id].followup = text || "";
    }

  function showCompletionPage() {
    persistFollowup();
    
    // Check if all questions are answered
    const allAnswered = QUESTIONS.every(q => {
      const answer = answers[q.id];
      return answer && answer.choice !== null && answer.choice !== undefined;
    });
    
    if (!allAnswered) {
      alert("Please answer all questions before completing the quiz.");
      return;
    }
    
    // Hide quiz content and show completion page
    quizContent.classList.add('hide');
    completionPage.classList.add('show');
    
    // Update progress to 100%
    progressBar.style.width = '100%';
  }

  function saveAndSubmit() {
    // Show loading state
    saveResultsBtn.classList.add('loading');
    saveResultsBtn.disabled = true;
    saveResultsBtn.innerHTML = '<span class="loading-spinner"></span>Saving Results...';
    
    // Prepare payload
    const payload = {
      submittedAt: new Date().toISOString(),
      answers
    };
    
    console.log("Career quiz submission:", payload);
    
    // Simulate saving time
    setTimeout(() => {
      // Redirect to React dashboard
      window.location.href = '/dashboard';
    }, 2000);
    
    // OPTIONAL: fetch('/api/quiz', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) })
  }

  function submit() {
    // Legacy function - now redirects to completion page
    showCompletionPage();
  }

  function resetQuizState() {
    // Reset quiz to initial state
    index = 0;
    // Clear all answers
    Object.keys(answers).forEach(key => delete answers[key]);
    
    // Reset UI elements
    quizContent.classList.remove('hide');
    completionPage.classList.remove('show');
    
    // Reset save button
    if (saveResultsBtn) {
      saveResultsBtn.classList.remove('loading');
      saveResultsBtn.disabled = false;
      saveResultsBtn.innerHTML = 'Save Results & Continue';
    }
    
    // Reset progress bar
    progressBar.style.width = '0%';
    
    // Re-render the first question
    render();
  }

  // Reset quiz when page loads (including back navigation)
  window.addEventListener('pageshow', function(event) {
    resetQuizState();
  });

  // Reset quiz when user returns to page
  document.addEventListener('visibilitychange', function() {
    if (!document.hidden) {
      resetQuizState();
    }
  });

  // init
  render();
  </script>
</body>

</html>